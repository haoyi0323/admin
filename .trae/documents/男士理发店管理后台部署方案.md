# 男士理发店管理后台部署方案

## 1. 项目概述

本文档提供男士理发店管理后台的完整部署方案，帮助用户将管理后台部署到自己的域名上，实现通过用户名密码登录后直接进入管理员面板的功能。

## 2. 部署前准备

### 2.1 环境要求
- Node.js 14.0 或以上版本
- 支持静态文件托管的Web服务器（如Nginx、Apache）
- uniCloud阿里云服务空间
- 域名和SSL证书

### 2.2 项目文件
- 管理后台源码：`男士理发店管理后台`文件夹
- 已配置的uniCloud云服务
- 数据库schema文件

## 3. 管理员账号创建和权限配置

### 3.1 创建管理员账号

1. **修改用户初始数据**
   编辑文件：`uniCloud-aliyun/database/uni-id-users.init_data.json`
   
   ```json
   [
     {
       "_id": "admin_001",
       "username": "admin",
       "password": "$2b$10$...", // 使用bcrypt加密的密码
       "nickname": "系统管理员",
       "role": ["admin"],
       "status": 0,
       "mobile": "13800138000",
       "mobile_confirmed": 1,
       "email": "admin@yourdomain.com",
       "email_confirmed": 1,
       "register_date": 1640995200000,
       "last_login_date": 1640995200000
     }
   ]
   ```

2. **配置管理员权限**
   编辑文件：`uniCloud-aliyun/database/uni-id-roles.init_data.json`
   
   ```json
   [
     {
       "role_id": "admin",
       "role_name": "超级管理员",
       "permission": [
         "USER_MANAGEMENT",
         "BOOKING_MANAGEMENT", 
         "SERVICE_MANAGEMENT",
         "STATISTICS_VIEW",
         "SYSTEM_CONFIG"
       ],
       "comment": "拥有所有权限的超级管理员"
     }
   ]
   ```

### 3.2 权限配置

编辑文件：`uniCloud-aliyun/database/uni-id-permissions.init_data.json`

```json
[
  {
    "permission_id": "USER_MANAGEMENT",
    "permission_name": "用户管理",
    "comment": "管理用户信息、会员卡等"
  },
  {
    "permission_id": "BOOKING_MANAGEMENT",
    "permission_name": "预约管理", 
    "comment": "管理预约信息、时间安排等"
  },
  {
    "permission_id": "SERVICE_MANAGEMENT",
    "permission_name": "服务管理",
    "comment": "管理服务项目、价格等"
  },
  {
    "permission_id": "STATISTICS_VIEW",
    "permission_name": "统计查看",
    "comment": "查看各类统计数据"
  },
  {
    "permission_id": "SYSTEM_CONFIG",
    "permission_name": "系统配置",
    "comment": "系统参数配置"
  }
]
```

## 4. H5网站部署步骤

### 4.1 项目构建

1. **安装依赖**
   ```bash
   cd 男士理发店管理后台
   npm install
   ```

2. **配置manifest.json**
   ```json
   {
     "h5": {
       "template": "template.h5.html",
       "router": {
         "mode": "hash",
         "base": "/admin/"
       },
       "publicPath": "https://yourdomain.com/admin/",
       "title": "男士理发店管理后台"
     }
   }
   ```

3. **构建生产版本**
   ```bash
   npm run build:h5
   ```

### 4.2 服务器部署

1. **上传文件**
   将`unpackage/dist/build/h5`目录下的所有文件上传到服务器的`/admin/`目录

2. **Nginx配置示例**
   ```nginx
   server {
       listen 80;
       listen 443 ssl;
       server_name yourdomain.com;
       
       # SSL配置
       ssl_certificate /path/to/your/certificate.crt;
       ssl_certificate_key /path/to/your/private.key;
       
       # 管理后台
       location /admin/ {
           alias /var/www/html/admin/;
           try_files $uri $uri/ /admin/index.html;
           index index.html;
       }
       
       # 静态资源缓存
       location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
           expires 1y;
           add_header Cache-Control "public, immutable";
       }
   }
   ```

3. **Apache配置示例**
   在`/admin/`目录下创建`.htaccess`文件：
   ```apache
   RewriteEngine On
   RewriteBase /admin/
   RewriteRule ^index\.html$ - [L]
   RewriteCond %{REQUEST_FILENAME} !-f
   RewriteCond %{REQUEST_FILENAME} !-d
   RewriteRule . /admin/index.html [L]
   ```

## 5. 登录系统配置和安全设置

### 5.1 登录配置

编辑文件：`admin.config.js`

```javascript
export default {
  login: {
    url: '/uni_modules/uni-id-pages/pages/login/login-withpwd'
  },
  index: {
    url: '/pages/index/index'
  },
  navBar: {
    logo: '/static/logo.png',
    title: '男士理发店管理后台'
  },
  sideBar: {
    staticMenu: [
      {
        menu_id: "user_management",
        text: '用户管理',
        icon: 'admin-icons-user',
        url: "/pages/system/user/user"
      },
      {
        menu_id: "booking_management", 
        text: '预约管理',
        icon: 'admin-icons-calendar',
        url: "/pages/booking/list"
      },
      {
        menu_id: "service_management",
        text: '服务管理', 
        icon: 'admin-icons-service',
        url: "/pages/service/list"
      }
    ]
  }
}
```

### 5.2 安全设置

1. **密码策略**
   - 最少8位字符
   - 包含大小写字母、数字和特殊字符
   - 定期更换密码

2. **会话管理**
   - 设置合理的会话超时时间
   - 启用HTTPS加密传输
   - 实现登录失败次数限制

3. **访问控制**
   ```javascript
   // 在main.js中添加路由守卫
   router.beforeEach((to, from, next) => {
     const token = uni.getStorageSync('uni_id_token')
     if (to.path !== '/login' && !token) {
       next('/login')
     } else {
       next()
     }
   })
   ```

## 6. 数据库初始化

### 6.1 uniCloud配置

1. **创建云服务空间**
   - 登录uniCloud控制台
   - 创建新的服务空间
   - 记录服务空间ID

2. **配置云服务空间**
   在HBuilderX中关联云服务空间：
   - 右键点击`uniCloud-aliyun`
   - 选择"关联云服务空间"
   - 选择已创建的服务空间

### 6.2 数据库初始化

1. **上传数据库Schema**
   ```bash
   # 在HBuilderX中右键uniCloud-aliyun/database
   # 选择"上传所有数据库schema及扩展校验函数"
   ```

2. **初始化数据**
   ```bash
   # 右键每个.init_data.json文件
   # 选择"初始化云数据库数据"
   ```

3. **部署云函数**
   ```bash
   # 右键uniCloud-aliyun/cloudfunctions
   # 选择"上传所有云函数"
   ```

## 7. 域名配置和访问路径

### 7.1 域名解析

1. **A记录配置**
   ```
   类型: A
   主机记录: @
   记录值: 服务器IP地址
   TTL: 600
   ```

2. **CNAME配置（如使用CDN）**
   ```
   类型: CNAME
   主机记录: www
   记录值: cdn.yourdomain.com
   TTL: 600
   ```

### 7.2 访问路径设置

- **管理后台访问地址**: `https://yourdomain.com/admin/`
- **登录页面**: `https://yourdomain.com/admin/#/uni_modules/uni-id-pages/pages/login/login-withpwd`
- **管理面板**: `https://yourdomain.com/admin/#/pages/index/index`

### 7.3 SSL证书配置

1. **申请SSL证书**
   - 免费证书：Let's Encrypt
   - 付费证书：阿里云、腾讯云等

2. **证书安装**
   ```bash
   # 将证书文件上传到服务器
   /etc/ssl/certs/yourdomain.com.crt
   /etc/ssl/private/yourdomain.com.key
   ```

## 8. 部署验证

### 8.1 功能测试

1. **访问测试**
   - 访问 `https://yourdomain.com/admin/`
   - 确认页面正常加载

2. **登录测试**
   - 使用配置的管理员账号登录
   - 验证登录后跳转到管理面板

3. **功能测试**
   - 测试各个管理模块
   - 验证数据读写功能

### 8.2 性能优化

1. **启用Gzip压缩**
   ```nginx
   gzip on;
   gzip_types text/plain text/css application/json application/javascript;
   ```

2. **设置缓存策略**
   ```nginx
   location ~* \.(js|css)$ {
       expires 1y;
       add_header Cache-Control "public, immutable";
   }
   ```

## 9. 维护和监控

### 9.1 日志监控

- 定期检查服务器访问日志
- 监控登录失败次数
- 关注异常访问模式

### 9.2 备份策略

- 定期备份数据库
- 备份配置文件
- 制定灾难恢复计划

### 9.3 更新维护

- 定期更新系统补丁
- 更新SSL证书
- 监控性能指标

## 10. 故障排除

### 10.1 常见问题

1. **无法访问管理后台**
   - 检查域名解析
   - 验证服务器配置
   - 确认防火墙设置

2. **登录失败**
   - 检查用户数据
   - 验证云函数部署
   - 确认网络连接

3. **页面加载缓慢**
   - 启用压缩
   - 优化静态资源
   - 使用CDN加速

### 10.2 技术支持

如遇到技术问题，可以：
- 查看uniCloud控制台日志
- 检查浏览器开发者工具
- 联系技术支持团队

---

**注意事项**：
1. 部署前请备份所有数据
2. 确保服务器安全配置
3. 定期更新系统和依赖
4. 监控系统运行状态